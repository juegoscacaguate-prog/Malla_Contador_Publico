<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Malla Curricular - Contador P√∫blico (FCEA UDELAR)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#6b9bd6;
    --accent-2:#9ad3c9;
    --danger:#ef4444;
    --glass: rgba(255,255,255,0.6);
    --soft-shadow: 0 6px 18px rgba(44,62,80,0.08);
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{
    margin:0;
    background: linear-gradient(180deg, #f6f8fb 0%, #ffffff 100%);
    color:#0f172a;
    padding:28px;
  }
  header{
    display:flex;
    align-items:center;
    gap:18px;
    margin-bottom:18px;
  }
  h1{margin:0;font-weight:600;font-size:20px}
  .sub{color:var(--muted);font-size:13px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  button, .btn {
    background:var(--card);
    border:1px solid rgba(15,23,42,0.06);
    padding:8px 12px;
    border-radius:10px;
    box-shadow:var(--soft-shadow);
    cursor:pointer;
    font-size:13px;
  }
  .btn-primary{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;border:none;
  }
  .layout{
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:14px;
  }
  @media (max-width:1100px){
    .layout{grid-template-columns: repeat(2, 1fr);}
  }
  @media (max-width:600px){
    .layout{grid-template-columns: 1fr;}
  }
  .column{
    background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.85));
    border-radius:12px;padding:12px;box-shadow:var(--soft-shadow);
    min-height:120px;
  }
  .col-title{font-weight:600;margin-bottom:8px}
  .course{
    background:var(--card);
    border-radius:10px;
    padding:10px;
    margin-bottom:10px;
    border:1px solid rgba(15,23,42,0.04);
    box-shadow: 0 6px 14px rgba(12,18,30,0.03);
    position:relative;
    cursor:pointer;
    transition:transform .12s ease, box-shadow .12s;
  }
  .course:hover{transform:translateY(-4px)}
  .course .title{font-weight:600;font-size:14px}
  .course .meta{font-size:12px;color:var(--muted);margin-top:6px;display:flex;gap:8px;flex-wrap:wrap}
  .course.approved{
    border-left:6px solid #34d399;
    opacity:0.9;
    background:linear-gradient(90deg, rgba(52,211,153,0.06), rgba(255,255,255,0.02));
  }
  .course.blocked{
    filter:grayscale(.06) contrast(.95);
    opacity:.95;
  }
  .overlay-locked{
    position:absolute;inset:0;background:linear-gradient(0deg, rgba(255,255,255,0.6), transparent);
    display:flex;align-items:center;justify-content:flex-end;padding:8px;border-radius:10px;pointer-events:none;
  }
  .padlock{font-size:14px;color:var(--muted);margin-right:6px}
  .tooltip{
    position:absolute;z-index:30;background: #0f172a;color:white;padding:8px 10px;border-radius:8px;font-size:13px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.2);max-width:260px;display:none;
  }
  .course:hover .tooltip{display:block}
  .small{font-size:12px;color:var(--muted)}
  .legend{display:flex;gap:10px;align-items:center;margin-top:8px}
  .legend .item{display:flex;gap:8px;align-items:center}
  .chip{width:12px;height:12px;border-radius:4px}
  .stats{margin-top:12px;font-size:13px;color:var(--muted)}
  footer{margin-top:18px;color:var(--muted);font-size:13px}
  .reset{background:transparent;border:1px dashed rgba(15,23,42,0.06);padding:6px 8px;border-radius:8px}
  /* tooltip arrow */
  .tooltip::after{content:"";position:absolute;left:12px;bottom:-6px;width:12px;height:12px;background:#0f172a;transform:rotate(45deg)}
  .prereq-list{margin-top:8px;font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div>
    <h1>Malla Curricular - Contador P√∫blico (FCEA UDELAR)</h1>
    <div class="sub">Interactiva ¬∑ Guardado local ¬∑ Requisitos bloqueantes ¬∑ Tooltips</div>
  </div>
  <div class="controls">
    <div class="small" id="creditsSummary">Cr√©ditos: 0</div>
    <button class="btn" id="exportBtn" title="Exportar/Importar progreso">Exportar</button>
    <button class="btn reset" id="resetBtn" title="Restablecer todo">Restablecer</button>
  </div>
</header>

<main>
  <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start">
    <div style="flex:1;min-width:300px">
      <div class="legend">
        <div class="item"><div class="chip" style="background: #ffffff;border:1px solid rgba(15,23,42,0.06)"></div><div class="small">Pendiente</div></div>
        <div class="item"><div class="chip" style="background:#34d399"></div><div class="small">Aprobada</div></div>
        <div class="item"><div class="chip" style="background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:4px"></div><div class="small">Bloqueada (faltan prereq)</div></div>
      </div>
      <div class="stats" id="areaStats"></div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="small">Leyenda de √°reas:</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;max-width:560px">
        <div class="small" style="background:#eaf2fb;padding:6px 8px;border-radius:8px">Contabilidad y Auditor√≠a</div>
        <div class="small" style="background:#f0fdf4;padding:6px 8px;border-radius:8px">Administraci√≥n</div>
        <div class="small" style="background:#fff7ed;padding:6px 8px;border-radius:8px">Econom√≠a</div>
        <div class="small" style="background:#f8fafc;padding:6px 8px;border-radius:8px">M√©todos Cuantitativos</div>
        <div class="small" style="background:#fef2f2;padding:6px 8px;border-radius:8px">Impuestos y Normativa</div>
        <div class="small" style="background:#eef2ff;padding:6px 8px;border-radius:8px">Gesti√≥n y Tecnolog√≠a</div>
        <div class="small" style="background:#f3f4f6;padding:6px 8px;border-radius:8px">Actividades Integradoras</div>
      </div>
    </div>
  </div>

  <div style="height:16px"></div>

  <div class="layout" id="grid">
    <!-- columnas se inyectan por JS -->
  </div>

  <div style="height:14px"></div>
  <div class="small prereq-list">
    <strong>Nota:</strong> los prerequisitos pueden ser cursos espec√≠ficos y/u objetivos de avance en cr√©ditos (por ejemplo: "120 cr√©ditos", "30 cr√©ditos en √°rea Econom√≠a"). Las materias con prerequisitos que no se cumplen aparecer√°n bloqueadas y mostrar√°n en el tooltip qu√© falta.
  </div>
</main>

<footer>
  Dise√±ado para revisi√≥n y uso personal ¬∑ Progreso guardado en el navegador (localStorage).
</footer>

<script>
/*
  Malla curricular - objeto con materias y prerequisitos.
  Requisitos soportados:
   - prereqCourses: array de nombres de cursos (exact match)
   - minTotalCredits: n√∫mero
   - areaCredits: [{area: 'Econom√≠a', min: 30}]
  Nota: si un prereq coincide con el mismo curso (auto-requisito err√≥neo), se ignora.
*/
const STORAGE_KEY = 'mallaContadorFCEA_v1';

// Lista de materias seg√∫n la estructura que diste (nombres copiados tal cual cuando fue claro)
const courses = [
  // Primer semestre
  { id: 'Conceptos Contables', title: 'Conceptos Contables', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'Primer semestre', prereqCourses: [] },
  { id: 'Administraci√≥n y Gesti√≥n de las Organizaciones I', title: 'Administraci√≥n y Gesti√≥n de las Organizaciones I', credits: 10, area: 'Administraci√≥n', semester: 'Primer semestre', prereqCourses: [] },
  { id: 'Introducci√≥n a la Microeconom√≠a', title: 'Introducci√≥n a la Microeconom√≠a', credits: 10, area: 'Econom√≠a', semester: 'Primer semestre', prereqCourses: [] },
  { id: 'C√°lculo I', title: 'C√°lculo I', credits: 10, area: 'M√©todos Cuantitativos', semester: 'Primer semestre', prereqCourses: [] },

  // Segundo semestre
  { id: 'Contabilidad General I', title: 'Contabilidad General I', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'SEGUNDO SEMESTRE', prereqCourses: ['Conceptos Contables'] },
  { id: 'Derecho y Actividad Empresarial I', title: 'Derecho y Actividad Empresarial I', credits: 10, area: 'Impuestos y Normativa', semester: 'SEGUNDO SEMESTRE', prereqCourses: [] },
  // Aqu√≠ hab√≠a un texto "Introducci√≥n a al Macroeconom√≠a (Requiere Introducci√≥n a la Macroeconom√≠a)" - asumimos que no requiere a s√≠ misma (error tipogr√°fico).
  { id: 'Introducci√≥n a la Macroeconom√≠a', title: 'Introducci√≥n a la Macroeconom√≠a', credits: 10, area: 'Econom√≠a', semester: 'SEGUNDO SEMESTRE', prereqCourses: [] },

  // Tercer semestre
  { id: 'Contabilidad General II', title: 'Contabilidad General II', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'Tercer semestre', prereqCourses: ['Contabilidad General I'] },
  { id: 'Derecho y Actividad Empresarial II', title: 'Derecho y Actividad Empresarial II', credits: 5, area: 'Impuestos y Normativa', semester: 'Tercer semestre', prereqCourses: [] },
  { id: 'Introducci√≥n a la Estad√≠stica', title: 'Introducci√≥n a la Estad√≠stica', credits: 10, area: 'M√©todos Cuantitativos', semester: 'Tercer semestre', prereqCourses: ['C√°lculo I'] },
  { id: 'Procesos Contables', title: 'Procesos Contables', credits: 5, area: 'Contabilidad y Auditor√≠a', semester: 'Tercer semestre', prereqCourses: ['Administraci√≥n y Gesti√≥n de las Organizaciones I','Conceptos Contables'] },

  // Cuarto semestre
  { id: 'Contabilidad General III', title: 'Contabilidad General III', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'Cuarto semestre', prereqCourses: ['Contabilidad General II'] },
  { id: 'Matem√°tica Financiera', title: 'Matem√°tica Financiera', credits: 10, area: 'M√©todos Cuantitativos', semester: 'Cuarto semestre', prereqCourses: ['C√°lculo I','Introducci√≥n a la Estad√≠stica'] },
  { id: 'Derecho Digital (2024)', title: 'Derecho Digital (2024)', credits: 5, area: 'Gesti√≥n y Tecnolog√≠a', semester: 'Cuarto semestre', prereqCourses: ['Derecho y Actividad Empresarial I','Derecho y Actividad Empresarial II'] },
  { id: 'Legislaci√≥n Laboral y Seguridad Social', title: 'Legislaci√≥n Laboral y Seguridad Social', credits: 10, area: 'Impuestos y Normativa', semester: 'Cuarto semestre', prereqCourses: ['Conceptos Contables','Derecho y Actividad Empresarial I'] },

  // Quinto semestre
  { id: 'Modelos y Sistemas de Costos', title: 'Modelos y Sistemas de Costos', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'Quinto semestre', prereqCourses: ['Contabilidad General III'] },
  { id: 'Derecho Tributario', title: 'Derecho Tributario', credits: 10, area: 'Impuestos y Normativa', semester: 'Quinto semestre', prereqCourses: ['Derecho y Actividad Empresarial I'] },
  { id: 'Contabilidad Social y Ambiental (2024)', title: 'Contabilidad Social y Ambiental (2024)', credits: 5, area: 'Contabilidad y Auditor√≠a', semester: 'Quinto semestre', prereqCourses: ['Contabilidad General III'] },
  { id: '√âtica y Ejercicio Profesional', title: '√âtica y Ejercicio Profesional', credits: 5, area: 'Actividades Integradoras', semester: 'Quinto semestre', prereqCourses: ['Contabilidad General III','Derecho y Actividad Empresarial I'] },

  // Sexto semestre
  { id: 'Contabilidad Superior I', title: 'Contabilidad Superior I', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'Sexto semestre', prereqCourses: ['Contabilidad General III'] },
  { id: 'Contabilidad Gerencial', title: 'Contabilidad Gerencial', credits: 10, area: 'Gesti√≥n y Tecnolog√≠a', semester: 'Sexto semestre',
    // requiere dos cursos + avance total 160 cr√©ditos (seg√∫n lo indicado)
    prereqCourses: ['Modelos y Sistemas de Costos','Matem√°tica Financiera'],
    minTotalCredits: 160
  },
  { id: 'Tributaria I', title: 'Tributaria I', credits: 10, area: 'Impuestos y Normativa', semester: 'Sexto semestre', prereqCourses: ['Contabilidad General III','Derecho Tributario'] },
  { id: 'Administraci√≥n y planificaci√≥n Financiera', title: 'Administraci√≥n y planificaci√≥n Financiera', credits: 5, area: 'Administraci√≥n', semester: 'Sexto semestre',
    prereqCourses: ['Matem√°tica Financiera','Contabilidad General III','Introducci√≥n a la Estad√≠stica'],
    minTotalCredits: 120
  },
  { id: 'Control Interno', title: 'Control Interno', credits: 10, area: 'Gesti√≥n y Tecnolog√≠a', semester: 'Sexto semestre', prereqCourses: ['Contabilidad General III','Procesos Contables'] },

  // S√©ptimo semestre
  { id: 'Auditor√≠a I', title: 'Auditor√≠a I', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'S√©ptimo semestre',
    prereqCourses: ['Derecho y Actividad Empresarial II','Legislaci√≥n Laboral y Seguridad Social','Control Interno','Contabilidad Superior I'],
    minTotalCredits: 160
  },
  { id: 'Tributaria II', title: 'Tributaria II', credits: 10, area: 'Impuestos y Normativa', semester: 'S√©ptimo semestre', prereqCourses: ['Tributaria I'] },
  { id: 'Finanzas Corporativas', title: 'Finanzas Corporativas', credits: 10, area: 'Administraci√≥n', semester: 'S√©ptimo semestre',
    prereqCourses: ['Modelos y Sistemas de Costos','Matem√°tica Financiera','Introducci√≥n a la Estad√≠stica','Administraci√≥n y Gesti√≥n de las Organizaciones I'],
    minTotalCredits: 180,
    areaCredits: [{area:'Econom√≠a', min:30}]
  },

  // Octavo semestre
  { id: 'Auditor√≠a Interna (2024)', title: 'Auditor√≠a Interna (2024)', credits: 5, area: 'Gesti√≥n y Tecnolog√≠a', semester: 'Octavo semestre', prereqCourses: ['Auditor√≠a I'] },
  { id: 'Informes Profesionales del Contador P√∫blico', title: 'Informes Profesionales del Contador P√∫blico', credits: 10, area: 'Contabilidad y Auditor√≠a', semester: 'Octavo semestre', prereqCourses: ['Auditor√≠a I'] },
  { id: 'Contabilidad en sistemas Integrados de Gesti√≥n (SIG/ERP) (2024)', title: 'Contabilidad en sistemas Integrados de Gesti√≥n (SIG/ERP) (2024)', credits: 5, area: 'Gesti√≥n y Tecnolog√≠a', semester: 'Octavo semestre',
    prereqCourses: [],
    // requiere avance de 180 cr√©ditos y 60 cr√©ditos en √°rea contable y/o gesti√≥n y tecnolog√≠a (simplificamos: requiere 180 totales y 60 en √°rea Contabilidad y Auditor√≠a o Gesti√≥n y Tecnolog√≠a)
    minTotalCredits: 180,
    areaCreditsOr: [{areas: ['Contabilidad y Auditor√≠a','Gesti√≥n y Tecnolog√≠a'], min:60}]
  },

  // Perfil Asesor√≠a Financiera (optativas / perfil)
  { id: 'Principios de An√°lisis Macroecon√≥mico Aplicado', title: 'Principios de An√°lisis Macroecon√≥mico Aplicado', credits: 10, area: 'Econom√≠a', semester: 'Perfil Asesor√≠a Financiera', prereqCourses: ['Introducci√≥n a la Macroeconom√≠a'] },
  { id: 'Proyectos de Inversi√≥n', title: 'Proyectos de Inversi√≥n', credits: 5, area: 'Administraci√≥n', semester: 'Perfil Asesor√≠a Financiera', prereqCourses: [] },
  { id: 'Econom√≠a y Gesti√≥n Bancaria', title: 'Econom√≠a y Gesti√≥n Bancaria', credits: 10, area: 'Econom√≠a', semester: 'Perfil Asesor√≠a Financiera', prereqCourses: [] },
  { id: 'Fintech', title: 'Fintech', credits: 5, area: 'Gesti√≥n y Tecnolog√≠a', semester: 'Perfil Asesor√≠a Financiera', prereqCourses: [] },
  { id: 'Econom√≠a y Finanzas P√∫blicas', title: 'Econom√≠a y Finanzas P√∫blicas', credits: 10, area: 'Econom√≠a', semester: 'Perfil Asesor√≠a Financiera', prereqCourses: ['Introducci√≥n a la Microeconom√≠a'] }
];

// Normalizar IDs y crear map
const courseMap = {};
courses.forEach(c => courseMap[c.id] = c);

// Carga de progreso desde localStorage
let state = { approved: {} };
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      const parsed = JSON.parse(raw);
      if(parsed && parsed.approved) state = parsed;
    }
  }catch(e){
    console.warn('Error cargando progreso', e);
  }
}
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

// util: calcular cr√©ditos totales aprobados y por √°rea
function computeCredits(){
  let total = 0;
  const area = {};
  for(const id of Object.keys(state.approved)){
    if(state.approved[id]){
      const c = courseMap[id];
      if(c){
        total += c.credits;
        area[c.area] = (area[c.area]||0) + c.credits;
      }
    }
  }
  return { total, area };
}

// comprobar prereqs de una materia -> devuelve array de strings con requisitos faltantes
function checkPrereqs(course){
  const missing = [];
  // cursos
  if(course.prereqCourses && course.prereqCourses.length){
    course.prereqCourses.forEach(req => {
      if(!req) return;
      if(req === course.id) return; // evitar auto-requisito err√≥neo
      if(!state.approved[req]) missing.push(req);
    });
  }
  // minTotalCredits
  if(course.minTotalCredits){
    const totals = computeCredits();
    if(totals.total < course.minTotalCredits) missing.push(`${course.minTotalCredits} cr√©ditos totales (tienes ${totals.total})`);
  }
  // areaCredits exact
  if(course.areaCredits && course.areaCredits.length){
    const totals = computeCredits();
    course.areaCredits.forEach(ac => {
      const have = totals.area[ac.area] || 0;
      if(have < ac.min) missing.push(`${ac.min} cr√©ditos en √°rea ${ac.area} (tienes ${have})`);
    });
  }
  // areaCreditsOr (any of areas)
  if(course.areaCreditsOr && course.areaCreditsOr.length){
    const totals = computeCredits();
    course.areaCreditsOr.forEach(t => {
      const haveAny = t.areas.some(a => (totals.area[a] || 0) >= t.min);
      if(!haveAny) missing.push(`${t.min} cr√©ditos en al menos una de estas √°reas: ${t.areas.join(', ')} (tienes ${JSON.stringify(totals.area)})`);
    });
  }
  return missing;
}

// Render
const grid = document.getElementById('grid');
function render(){
  grid.innerHTML = '';
  // Agrupar por semester en orden deseado
  const order = ['Primer semestre','SEGUNDO SEMESTRE','Tercer semestre','Cuarto semestre','Quinto semestre','Sexto semestre','S√©ptimo semestre','Octavo semestre','Perfil Asesor√≠a Financiera'];
  for(const sem of order){
    const col = document.createElement('div');
    col.className = 'column';
    col.dataset.sem = sem;
    const title = document.createElement('div');
    title.className = 'col-title';
    title.textContent = sem;
    col.appendChild(title);

    const semCourses = courses.filter(c => c.semester === sem);
    if(semCourses.length === 0){
      const p = document.createElement('div');
      p.className = 'small';
      p.textContent = '‚Äî';
      col.appendChild(p);
    } else {
      semCourses.forEach(c => {
        const card = document.createElement('div');
        card.className = 'course';
        if(state.approved[c.id]) card.classList.add('approved');

        // comprobar si bloqueada
        const missing = checkPrereqs(c);
        const blocked = missing.length > 0 && !state.approved[c.id];
        if(blocked) card.classList.add('blocked');

        // contenido
        const t = document.createElement('div');
        t.className = 'title';
        t.textContent = c.title;
        card.appendChild(t);

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `<div>${c.credits} cr.</div><div>√Årea: ${c.area}</div>`;
        card.appendChild(meta);

        // small prereq list visible
        if(c.prereqCourses && c.prereqCourses.length){
          const pr = document.createElement('div');
          pr.className = 'small';
          pr.style.marginTop = '8px';
          pr.textContent = 'Requiere: ' + c.prereqCourses.join(', ');
          card.appendChild(pr);
        }
        if(c.minTotalCredits){
          const pr2 = document.createElement('div');
          pr2.className = 'small';
          pr2.textContent = 'Requiere avance total: ' + c.minTotalCredits + ' cr√©ditos';
          card.appendChild(pr2);
        }
        if(c.areaCredits){
          c.areaCredits.forEach(ac=>{
            const pr3 = document.createElement('div');
            pr3.className = 'small';
            pr3.textContent = `Requiere ${ac.min} cr√©ditos en √°rea ${ac.area}`;
            card.appendChild(pr3);
          });
        }
        if(c.areaCreditsOr){
          c.areaCreditsOr.forEach(ac=>{
            const pr3 = document.createElement('div');
            pr3.className = 'small';
            pr3.textContent = `Requiere ${ac.min} cr√©ditos en una de estas √°reas: ${ac.areas.join(', ')}`;
            card.appendChild(pr3);
          });
        }

        // tooltip con faltantes
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        if(blocked){
          tooltip.innerHTML = `<strong>Faltan requisitos:</strong><br><ul>${missing.map(m=>`<li>${m}</li>`).join('')}</ul>`;
        } else {
          tooltip.innerHTML = `<strong>${ state.approved[c.id] ? 'Aprobada' : 'Disponible' }</strong><br>Haz clic para marcar${ state.approved[c.id] ? ' como no aprobada' : ' como aprobada' }.`;
        }
        card.appendChild(tooltip);

        // overlay lock
        if(blocked){
          const overlay = document.createElement('div');
          overlay.className = 'overlay-locked';
          overlay.innerHTML = `<div style="display:flex;align-items:center;gap:6px"><div class="padlock">üîí</div><div class="small">Bloqueada</div></div>`;
          card.appendChild(overlay);
        }

        // click handler
        card.addEventListener('click', (e)=>{
          const missingNow = checkPrereqs(c);
          const isBlocked = missingNow.length > 0 && !state.approved[c.id];
          if(isBlocked){
            // mostrar un peque√±o efecto visual (temblor) y resaltar tooltip
            card.animate([{transform:'translateX(-4px)'},{transform:'translateX(4px)'},{transform:'translateX(0)'}],{duration:220});
            tooltip.style.display = 'block';
            setTimeout(()=>{ if(!state.approved[c.id]) tooltip.style.display = ''; }, 1400);
            return;
          }
          // toggle aprobado
          state.approved[c.id] = !state.approved[c.id];
          saveState();
          render();
          updateSummary();
        });

        col.appendChild(card);
      });
    }
    grid.appendChild(col);
  }
}

// Resumen de cr√©ditos y √°reas
const creditsSummaryEl = document.getElementById('creditsSummary');
const areaStatsEl = document.getElementById('areaStats');
function updateSummary(){
  const totals = computeCredits();
  creditsSummaryEl.textContent = `Cr√©ditos aprobados: ${totals.total}`;
  // mostrar por √°rea
  const parts = Object.entries(totals.area).map(([a, c])=>`${a}: ${c} cr.`).join(' ¬∑ ');
  areaStatsEl.textContent = parts ? `Cr√©ditos por √°rea ‚Äî ${parts}` : 'A√∫n no ten√©s cr√©ditos aprobados.';
}

// reset
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(!confirm('¬øRestablecer todo el progreso? Esta acci√≥n no puede deshacerse.')) return;
  state = { approved: {} };
  saveState();
  render();
  updateSummary();
});

// exportar/importar
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = JSON.stringify(state, null, 2);
  // abrir prompt para copiar/pegar o importar
  const w = window.open('', '', 'width=700,height=520');
  w.document.body.style.fontFamily = 'Inter,Arial, sans-serif';
  w.document.body.innerHTML = '<h3>Exportar / Importar Progreso</h3><p>Copia el texto para exportar. Para importar, pega el JSON abajo y haz click en "Importar".</p><textarea id="txt" style="width:95%;height:320px;font-family:monospace;">' + data + '</textarea><div style="margin-top:8px"><button id="doImport">Importar</button><button id="doClose" style="margin-left:8px">Cerrar</button></div>';
  w.document.getElementById('doClose').addEventListener('click', ()=>w.close());
  w.document.getElementById('doImport').addEventListener('click', ()=>{
    const txt = w.document.getElementById('txt').value;
    try{
      const parsed = JSON.parse(txt);
      if(parsed && parsed.approved){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
        loadState();
        render();
        updateSummary();
        alert('Importaci√≥n exitosa');
      } else {
        alert('JSON inv√°lido (no contiene approved).');
      }
    }catch(e){
      alert('JSON inv√°lido: ' + e.message);
    }
  });
});

// inicializar
loadState();
render();
updateSummary();

// Guardar auto cuando hay cambios en otra pesta√±a
window.addEventListener('storage', (e)=>{
  if(e.key === STORAGE_KEY){
    loadState();
    render();
    updateSummary();
  }
});
</script>
</body>
</html>
